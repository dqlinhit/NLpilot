<!DOCTYPE html>
<html>
<head>
    <title>Tạo Đơn Hàng Trading</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        input, select { width: 100%; margin-bottom: 10px; padding: 10px; }
        button { background-color: #2481cc; color: white; border: none; padding: 10px 20px; width: 100%; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h3>Lên Đơn Hàng Mới</h3>
    <input type="text" id="customer" placeholder="Tên khách hàng">
    <input type="text" id="product" placeholder="Mã hàng hóa">
    <input type="number" id="quantity" placeholder="Số lượng">
    <input type="number" id="price" placeholder="Đơn giá">
    <button onclick="sendOrder()">Gửi Đơn Hàng</button>

    <script>
        // Khởi tạo WebApp
        let tg = window.Telegram.WebApp;
        tg.expand(); // Mở full màn hình

        let data = {
                customer: document.getElementById("customer").value,
                product: document.getElementById("product").value,
                quantity: document.getElementById("quantity").value,
                price: document.getElementById("price").value,
                action: "create_order",
                telegram_user_id: tg.initDataUnsafe?.user?.id
        };

        const n8nWebhookUrl = 'https://nlpilot.app.n8n.cloud/webhook-test/687494c6-435b-4a3d-aaad-1d96588ea9c8/webhook';

        fetch(n8nWebhookUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => {
            alert("Đã gửi đơn hàng thành công!");
            tg.close(); // Đóng sau khi gửi thành công
        })
        .catch((error) => {
            alert("Lỗi gửi đơn: " + error);
        });

        // function sendOrder() {
        //     let data = {
        //         customer: document.getElementById("customer").value,
        //         product: document.getElementById("product").value,
        //         quantity: document.getElementById("quantity").value,
        //         price: document.getElementById("price").value,
        //         action: "create_order",
        //         telegram_user_id: tg.initDataUnsafe?.user?.id
        //     };


        //     let dataString = JSON.stringify(data);
            
        //     // Gửi dữ liệu ngược lại về Bot (dưới dạng JSON string)
        //     tg.sendData(dataString); 
            
        //     // Đóng Mini App sau khi gửi
        //     tg.close();
        }
    </script>
</body>
</html>
